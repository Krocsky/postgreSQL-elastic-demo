# 索引数据库类库

## 安装

`npm install @cybereits/lib-es-client`

## 文档

- 目前elasticsearch我们的数据类型都为text，text能够自动分词，如有其它Date、Range等类型，再补充Mapping

### elasticsearch Client初始化

- 日志变量LogLevel
  
  - error
  - warning
  - info
  - debug
  - trace

- 方法 initClient
  
  - 参数 -- host ：主机地址
  - 参数 -- port ：es端口
  - 参数 -- logLevel ：日志等级默认info日志

```javascript
import { initClient, LogLevel } from '@cybereits/lib-es-client'

const esClient = initClient('127.0.0.1', '9200', LogLevel.INFO)
```

### Document操作方法

- 创建和更新document createOrUpdateDocument，id 为文档的唯一标识，如果没有此id则创建，有则更新此文档，参数如下

  - esClient elasticsearch连接实体
  - indexName 索引名称，自动创建索引
  - _type 文档类型
  - documentId 文档id
  - documentBody 文档内容，json 格式 ```{ 'name': 'cybereits', phone: '+11909' }```

```javascript
    createOrUpdateDocument(esClient, 'temp_user', userType, '5345', documentBody).then((res) => {
      console.log(res)
      // Todo
    })
```

- 根据自定义字段查找 searchByCustomProperty

  - esClient elasticsearch连接实体
  - indexName 索引名称，自动创建索引
  - _type 文档类型
  - customPropertyString 自定义字段值

```javascript
    searchByCustomProperty(esClient, userIndex, userType, '山东省').then((res) => {
      console.log(res)
    })

    ==> 返回结果
    [
         {
            "_index":"user",
            "_type":"perosnal_user",
            "_id":"9",
            "_source":{
               "user_name":"XXX",
               "phone":"1855325972356",
               "block_address":"0x0005fD6bCa6d214f23C69419D14711E043D4280F",
               "custom_property":"籍贯:XXX省 NickName:Duzitong 薪水:98K"
            }
         }
      ]
```

- 根据id查找 searchById

  - esClient elasticsearch连接实体
  - indexName 索引名称，自动创建索引
  - _type 文档类型
  - documentId 文档id

```javascript
    searchById(esClient, userIndex, userType, '1').then((res) => {
      console.log(res)
    })

    ==> 返回结果
    [
         {
            "_index":"user",
            "_type":"perosnal_user",
            "_id":"9",
            "_source":{
               "user_name":"XXX",
               "phone":"1855325972356",
               "block_address":"0x0005fD6bCa6d214f23C69419D14711E043D4280F",
               "custom_property":"籍贯:XXX省 NickName:Duzitong 薪水:98K"
            }
         }
      ]
```

- 根据id数组查找 searchByIds

  - esClient elasticsearch连接实体
  - indexName 索引名称，自动创建索引
  - _type 文档类型
  - documentIds 文档id的一维数组

```javascript
    searchByIds(esClient, userIndex, userType, ['4', '9']).then((res) => {
      console.log(res)
    })

    ==> 返回结果
    [
         {
            "_index":"user",
            "_type":"perosnal_user",
            "_id":"9",
            "_source":{
               "user_name":"XXX",
               "phone":"1855325972356",
               "block_address":"0x0005fD6bCa6d214f23C69419D14711E043D4280F",
               "custom_property":"籍贯:XXX省 NickName:Duzitong 薪水:98K"
            }
         }
      ]
```

- 指定字段和字段值查询用户 searchByFields

  - esClient elasticsearch连接实体
  - indexName 索引名称，自动创建索引
  - _type 文档类型
  - fieldValue 要查询的关键字
  - fieldsKeys key值的以为数组

```javascript
    searchByFields(esClient, userIndex, userType, '185****9756', ['phone', 'user_name']).then((res) => {
      console.log(res)
    })

    ==> 返回结果
    [
         {
            "_index":"user",
            "_type":"perosnal_user",
            "_id":"9",
            "_source":{
               "user_name":"XXX",
               "phone":"1855325972356",
               "block_address":"0x0005fD6bCa6d214f23C69419D14711E043D4280F",
               "custom_property":"籍贯:XXX省 NickName:Duzitong 薪水:98K"
            }
         }
      ]
```