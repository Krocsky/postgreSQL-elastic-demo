const { expect } = require('chai')

const { LogLevel, initClient } = require('../src/index')
const { createIndex, deleteIndex, isExist } = require('../src/indices/index')
const { createOrUpdateDocument, searchByCustomProperty, searchByIds, searchByFields } = require('../src/documents/index')

const esClient = initClient('localhost')

// consts
const userIndex = 'user'
const userType = 'perosnal_user'
const documentId = '9'
const documentBody = {
  "user_name": "程序猴",
  "phone": "1855325972356",
  "block_address": "0x0005fD6bCa6d214f23C69419D14711E043D4280F",
  "custom_property": "籍贯:山东省 NickName:Duzitong 薪水:98K",
}

// describe('创建索引', () => {
//   it('创建名为user的索引', () =>
//     createIndex(esClient, userIndex)
//     .then((res) => {
//       expect(res.acknowledged).is.true
//       expect(res.shards_acknowledged).is.true
//       expect(res.index).eq('user')
//     })
//   )
// })

// describe('删除索引', () => {
//   it('删除名为user的索引', () =>
//     deleteIndex(esClient, 'user')
//     .then((res) => {
//       expect(res.acknowledged).is.true
//     })
//   )
// })

// describe('创建用户文档', () => {
//   it('index存在', () =>
//     createOrUpdateDocument(esClient, userIndex, userType, documentId, documentBody).then((res) => {
//       console.log('lalal', res)
//     })
//   )
// })

// describe('用不存在的index创建文档', () => {
//   it('index不存在', () =>
//     createOrUpdateDocument(esClient, 'temp_user', userType, '5345', documentBody).then((res) => {
//       console.log('lalal', res)
//     })
//   )
// })

// describe('查询用户', () => {
//   it('根据自定义字段值查询', () =>
//     searchByCustomProperty(esClient, userIndex, userType, '山东省').then((data) => {
//       console.log(`输出结果 ${ JSON.stringify(data) }`)
//       let dataKeys = Object.keys(data)
//       expect(dataKeys.length).is.greaterThan(0)
//     })
//     .catch((ex) => {
//       throw new Error(ex)
//     })
//   )
// })

// describe('查询用户', () => {
//   it('根据id数组查询用户', () =>
//     searchByIds(esClient, userIndex, userType, ['4', '9'])
//     .then((data) => {
//       console.log(`输出结果 ${ JSON.stringify(data) }`)
//       let dataKeys = Object.keys(data)
//       expect(dataKeys.length).is.greaterThan(0)
//     })
//     .catch((ex) => {
//       throw new Error(ex)
//     })
//   )
// })

describe('查询用户', () => {
  it('指定fields查询用户', () =>
    searchByFields(esClient, userIndex, userType, '18553259756', ['phone', 'user_name']).then((data) => {
      console.log(`输出结果 ${ JSON.stringify(data) }`)
      let dataKeys = Object.keys(data)
      expect(dataKeys.length).is.greaterThan(0)
    })
    .catch((ex) => {
      throw new Error(ex)
    })
  )
})
